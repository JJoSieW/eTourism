<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  ================================================== -->
  <meta charset="utf-8">
  <title>eTourism | User Management</title>

  <!-- Mobile Specific Metas
  ================================================== -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Construction Html5 Template">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="author" content="Themefisher">
  <meta name="generator" content="Themefisher Constra HTML Template v1.0">
  
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="images/favicon.png" />
  
  <!-- Themefisher Icon font -->
  <link rel="stylesheet" href="plugins/themefisher-font/style.css">
  <!-- bootstrap.min css -->
  <link rel="stylesheet" href="plugins/bootstrap/css/bootstrap.min.css">
  
  <!-- Animate css -->
  <link rel="stylesheet" href="plugins/animate/animate.css">
  <!-- Slick Carousel -->
  <link rel="stylesheet" href="plugins/slick/slick.css">
  <link rel="stylesheet" href="plugins/slick/slick-theme.css">
  
  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="css/style.css">
  <script src="scripts/app.js"></script>
  <script src="scripts/profile.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="scripts/app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
<!-- Start Top Header Bar -->
<section class="top-header">
	<div class="container">
		<div class="row">
            <div class="col-md-0 col-xs-12 col-sm-4">
                <div class="contact-number">
                    <i class="tf-ion-ios-telephone"></i>
                    <span>020- 1234-1234</span>
                </div>
            </div>
            <div class="col-md-4 col-xs-12 col-sm-4">
                <!-- Site Logo -->
                <div class="logo text-center">
                  <a href="/">
                    <!-- replace logo here -->
                    <svg width="300px" height="36px" viewBox="0 0 150 35" version="1.1" xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink">
                      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" font-size="40"
                        font-family="AustinBold, Austin" font-weight="bold">
                        <g id="Group" transform="translate(-160.000000, -297.000000)" fill="#000000">
                          <text id="eTourism">
                            <tspan x="88.94" y="328">Admin System</tspan>
                          </text>
                        </g>
                      </g>
                    </svg>
                  </a>
                </div>
              </div>
              <div class="col-md-4 col-xs-12 col-sm-4">
				<ul class="top-menu text-right list-inline">
					<!-- Search -->
                    <li class="dropdown search dropdown-slide">
                        <a href="/experiences"><i class="tf-ion-ios-search-strong"></i> Search</a>
                    </li><!-- / Search -->

				</ul><!-- / .nav .navbar-nav .navbar-right -->
			</div>
		</div>
	</div>
</section><!-- End Top Header Bar -->
<!-- Main Menu Section -->
<section class="menu row">
    <div class="row">
        <div class="content">
            <ul class="nav nav-tabs">
                <li><a href="/">Home <span class="label label-badge label-success"></span></a></li>
                <li class="active"><a href="/userDashboard">User Management<span class="label label-badge label-success"></span></a></li>
            </ul>
        </div>
        <nav class="navbar navigation">
            <div class="container">
                <div class="navbar-header  pull-right">
                    <h2 class="menu-title">Main Menu</h2>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                        aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div><!-- / .navbar-header -->
                <!-- Navbar Links -->
                <div id="navbar" class="navbar-collapse collapse text-center  pull-right">
                    <ul class="nav navbar-nav">
                        <!-- Experience -->
                        <li class="dropdown dropdown-slide">
                            <a href="#!" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="350"
                                role="button" aria-haspopup="true" aria-expanded="false">Experience <span
                                    class="tf-ion-ios-arrow-down"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="/experiences">Browse & Book</a></li>
                                <li><a href="/create">Create</a></li>
                            </ul>
                        </li><!-- / Experience -->
                        <!-- My account -->
                        <li class="dropdown dropdown-slide">
                            <a href="#!" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="350"
                                role="button" aria-haspopup="true" aria-expanded="false">My account <span
                                    class="tf-ion-ios-arrow-down"></span></a>
                            <ul class="dropdown-menu">
                                <li><div id="profile-link"></div></li>
                                <li><div id="logout-link" onclick="logout()"></div></li>
                                <li><div id="login-link"></div></li>
                                <li><div id="register-link"></div></li>
                            </ul>
                        </li><!-- / My account -->
                    </ul><!-- / .nav .navbar-nav -->
                </div>
            </div>
        </nav>
            <!--/.navbar-collapse -->
    </div>
    <script>
        let profileLinkDiv = document.getElementById("profile-link");
        let profileLink = document.createElement("a");
        user = localStorage.getItem("user");
        if(user){
            profileLink.href = "/profile?username="+JSON.parse(user).name;
        }else{
            profileLink.href = "/login";
        }
        profileLink.innerHTML = 'profile';
        profileLinkDiv.appendChild(profileLink);
        user = localStorage.getItem("user");
        if(user){
            let logoutLinkDiv = document.getElementById("logout-link");
            let logoutLink = document.createElement("a");
            logoutLink.innerHTML = 'log out';
            logoutLinkDiv.appendChild(logoutLink);
        }else{
            let loginLinkDiv = document.getElementById("login-link");
            let loginLink = document.createElement("a");
            loginLink.href = "/login";
            loginLink.innerHTML = 'log in';
            loginLinkDiv.appendChild(loginLink);
            let registerLinkDiv = document.getElementById("register-link");
            let registerLink = document.createElement("a");
            registerLink.href = "/register";
            registerLink.innerHTML = 'sign up';
            registerLinkDiv.appendChild(registerLink);
        }
    </script>

</section>
<section>
    <div class="container">
        <section class="page-header">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="content">
                            <h3 class="page-name">User Management</h3>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="row">
            <div class="col-md-12 col-xs-6 col-sm-4">
            <div class="dashboard-wrapper user-dashboard">
                <div class="table-responsive">
                <table class="table">
                    <thead>
                    <tr>
                        <th class="col-md-3 col-xs-6 col-sm-4" style="text-align:center;">Username</th>
                        <th class="col-md-3 col-xs-6 col-sm-4"style="text-align:center">Role</th>
                        <th class="col-md-3 col-xs-6 col-sm-4"style="text-align:center">Status</th>
                        <th class="col-md-0 col-xs-6 col-sm-4"style="text-align:center"></th>
                        <!-- <th style="text-align:center">Alter Status</th> -->
                    </tr>
                    </thead>
                    <tbody style="text-align:center;font-family:'Roboto',sans-serif;  font-weight:300; ">
                    </tbody>
                </table>

                    <ul class="pager">
                        <li class="previous"><a href="your/nice/url">«</a></li>
                        <li><a href="your/nice/url">1</a></li>
                        <li class="active"><a href="your/nice/url">2</a></li>
                        <li><a href="your/nice/url">3</a></li>
                        <li><a href="your/nice/url">4</a></li>
                        <li><a href="your/nice/url">5</a></li>
                        <li class="next"><a href="your/nice/url">»</a></li>
                    </ul>

                
                <script>
                    checkLoginStatus();
                
                    if(user.userType!="admin"){
                        alert("Only admin can access this page")
                        location.href="/login";
                    }
                    var data=0
                    function sendAxiosQuery(url, data) {
                        axios.post(url, data)
                            .catch(function (response) {
                                alert(response.toJSON());
                            })
                    }
                    axios.post('/getAllUser')
                        .then((data=>{
                            data = data.data;
                            //experiencesToShow = experiences;
                            //showExperiences();
                            console.log(data)
                            var datas=[];
                            var newEx={};
                            for (var i = 0 ; i < data.length ; i++){
                                newEx={};
                
                                //datas[i]["title"]=0;
                                newEx["name"]=data[i]["name"];
                
                                newEx["userType"]=data[i]["userType"];
                                newEx["status"]=data[i]["status"];
                                //newEx["title"]=0;
                                datas.push(newEx);
                            }
                            console.log(newEx);
                
                            var change_id=-1;
                            var tbody =document.querySelector('tbody');
                            for(var i = 0 ; i < datas.length ; i++){
                                //create line
                                var tr = document.createElement('tr');
                                tbody.appendChild(tr);
                                //create cell
                                var index=0
                                for (var k in datas[i] ){
                                    var td = document.createElement("td");
                                    td.innerText = datas[i][k];
                                    if (index==0){
                                        // td.innerHTML="<a href='/profile?userId="+data[i]._id+"'><p>"+datas[i][k]+"</p></a>"
                                    }
                                    tr.appendChild(td);
                                    index=index+1;
                                }
                                //create button cell
                                var btnApprove = document.createElement('td');
                                // btnApprove.innerHTML = '<a href="JavaScript:;">Staff/User</a>'; 
                                btnApprove.innerHTML = '<a href="JavaScript:;">Alter Role</a>'; 
                                btnApprove.style = " border:0.1em solid #000000;  margin:0 0em 0em 0;  border-radius:0.12em;  box-sizing: border-box; display:block;margin:1px auto;"
                                // btnApprove.style = 'font-weight:bolder;color:black;opacity:0.4;';
                                // btnApprove.className = 'btn btn-success col-md-0 col-md-offset-2'
                                btnApprove.id=i;
                                tr.appendChild(btnApprove);
                
                                btnApprove.onclick = function () {
                
                                    console.log(datas[this.id]["userType"],type);
                                    if(datas[this.id]["userType"]=="staff"){
                                        var type="user";
                                    }else{
                                        var type="staff";
                                    }
                                    //alert(parseInt(this.id) +10);
                                    console.log(datas[this.id]["userType"],type);
                
                                    alert("User type has been changed!");
                                    change_name=this.id;
                
                                    var changeData={};
                                    changeData["name"]=datas[this.id]["name"];
                                    changeData["userType"]=type;
                                    changeData["status"]=datas[this.id]["status"];
                
                                    console.log(changeData);
                                    sendAxiosQuery('/usrDashboard',changeData);
                                    //window.location.replace("http://localhost:3000/usrDashboard")
                                    window.location.refresh()
                                    event.preventDefault();
                                }
                                var btnReject = document.createElement("td");
                                btnReject.innerText = i;
                                btnReject.innerHTML = '<a href="JavaScript:;">Alter Status</a>';
                                btnReject.style = " border:0.1em solid #000000;  margin:0 0em 0em 0;  border-radius:0.12em;  box-sizing: border-box; display:block;margin:1px auto;"
                                btnReject.id=i;
                                tr.appendChild(btnReject);
                                btnReject.onclick = function () {
                                    if(datas[this.id]["status"]=="suspended"){
                                        var status="normal";
                                    }else{
                                        var status="suspended";
                                    }
                                    alert("User status has been changed!");
                                    change_name=this.id;
                
                                    var changeData={};
                                    changeData["name"]=datas[this.id]["name"];
                                    changeData["status"]=status;
                                    changeData["userType"]=datas[this.id]["userType"];
                                    console.log(changeData);
                                    sendAxiosQuery('/usrDashboard',changeData);
                                    //window.location.replace("http://localhost:3000/usrDashboard")
                                    window.location.refresh()
                                    event.preventDefault();
                
                                }
                
                
                            }
                            var as = document.querySelectorAll('a');
                            for (var i = 0 ; i <as.length ; i++){
                                as[i].onclick = function(){
                                    //delate line
                                    //alert(parseInt(this.id) +20);
                                    //tbody.removeChild(this.parentNode.parentNode);
                                }
                            }
                
                        }))
                        .catch()
                    ;
                
                    //data
                    //var marks=[0,0,0,0];
                    // var datas = [
                    //     {
                    //         title:'Jack',
                    //         description:'JavaScript',
                    //         status:'under review'
                    //     },
                    //     {
                    //         title:'Jimmy',
                    //         description:'JavaScript',
                    //         status:'under review'
                    //     },
                    //     {
                    //         title:'Kim',
                    //         description:'JavaScript',
                    //         status:'under review'
                    //     },
                    //     {
                    //         title:'Anna',
                    //         description:'JavaScript',
                    //         status:'under review'
                    //     }
                    // ];
                
                
                    //create line
                
                    //console.log("id:"+change_id);
                
                </script>
                </div>
            </div>
            </div>
        </div>
    </div>
</section>
</body>

<footer class="footer section text-center">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<ul class="social-media">
					<li>
						<a href="https://www.facebook.com/themefisher">
							<i class="tf-ion-social-facebook"></i>
						</a>
					</li>
					<li>
						<a href="https://www.instagram.com/themefisher">
							<i class="tf-ion-social-instagram"></i>
						</a>
					</li>
					<li>
						<a href="https://www.twitter.com/themefisher">
							<i class="tf-ion-social-twitter"></i>
						</a>
					</li>
					<li>
						<a href="https://www.pinterest.com/themefisher/">
							<i class="tf-ion-social-pinterest"></i>
						</a>
					</li>
				</ul>
				<ul class="footer-menu text-uppercase">
					<li>
						<a href="contact.html">CONTACT</a>
					</li>
					<li>
						<a href="shop.html">SHOP</a>
					</li>
					<li>
						<a href="pricing.html">Pricing</a>
					</li>
					<li>
						<a href="contact.html">PRIVACY POLICY</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
</footer>
    <!-- 
    Essential Scripts
    =====================================-->
    
    <!-- Main jQuery -->
    <script src="plugins/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap 3.1 -->
    <script src="plugins/bootstrap/js/bootstrap.min.js"></script>
    <!-- Bootstrap Touchpin -->
    <script src="plugins/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>
    <!-- Instagram Feed Js -->
    <script src="plugins/instafeed/instafeed.min.js"></script>
    <!-- Video Lightbox Plugin -->
    <script src="plugins/ekko-lightbox/dist/ekko-lightbox.min.js"></script>
    <!-- Count Down Js -->
    <script src="plugins/syo-timer/build/jquery.syotimer.min.js"></script>

    <!-- slick Carousel -->
    <script src="plugins/slick/slick.min.js"></script>
    <script src="plugins/slick/slick-animation.min.js"></script>

    <!-- Google Mapl -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCC72vZw-6tGqFyRhhg5CkF2fqfILn2Tsw"></script>
    <script type="text/javascript" src="plugins/google-map/gmap.js"></script>

    <!-- Main Js File -->
    <script src="js/script.js"></script>
    


  </body>
</html>